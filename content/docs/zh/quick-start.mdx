---
title: 快速开始
description: 如何快速安装和运行 ImageFlow
---

# 快速开始

本指南将帮助您快速安装和配置 ImageFlow。

### 前置条件

- Go 1.22 或更高版本
- Node.js 18 或更高版本（用于构建前端）
- WebP 工具（`libwebp-tools`）
- AVIF 工具（`libavif-apps`）
- Redis（可选，用于元数据和标签存储）
- Docker 和 Docker Compose（可选，用于容器化部署）

### 安装

#### 方法一：直接安装

1.  克隆仓库

    ```bash
    git clone https://github.com/Yuri-NagaSaki/ImageFlow.git
    cd ImageFlow
    ```

2.  构建前端

    ```bash
    cd frontend
    bash build.sh
    cd ..
    ```

3.  构建后端

    ```bash
    go mod tidy
    go build -o imageflow
    ```

4.  配置环境变量

    ```bash
    cp .env.example .env
    # 编辑 .env 文件进行配置
    ```

5.  设置系统服务（以 systemd 为例）

    ```ini filename="/etc/systemd/system/imageflow.service"
    [Unit]
    Description=ImageFlow Service
    After=network.target

    [Service]
    ExecStart=/path/to/imageflow
    WorkingDirectory=/path/to/imageflow/directory
    Restart=always
    User=youruser
    EnvironmentFile=/path/to/imageflow/.env

    [Install]
    WantedBy=multi-user.target
    ```

6.  启用服务

    ```bash
    sudo systemctl enable imageflow
    sudo systemctl start imageflow
    ```

#### 方法二：Docker 部署

1.  使用预构建镜像（推荐）

    ```bash
    # 1. 克隆仓库
    git clone https://github.com/Yuri-NagaSaki/ImageFlow.git
    cd ImageFlow

    # 2. 配置环境变量
    cp .env.example .env
    # 编辑 .env 文件

    # 3. 启动服务
    docker compose up -d
    ```

2.  本地构建部署

    ```bash
    # 1. 克隆仓库
    git clone https://github.com/Yuri-NagaSaki/ImageFlow.git
    cd ImageFlow

    # 2. 配置环境变量
    cp .env.example .env
    # 编辑 .env 文件

    # 3. 构建并启动
    docker compose -f docker-compose-build.yml up --build -d
    ```

### 配置说明

通过创建和编辑 `.env` 文件配置系统。以下是主要配置项说明：

```bash filename=".env"
# API 密钥配置
API_KEY=your_api_key_here  # 设置您的 API 密钥

# 存储配置
STORAGE_TYPE=local  # 存储类型：local（本地存储）或 s3（S3 兼容存储）
LOCAL_STORAGE_PATH=static/images  # 本地存储路径

# Redis 配置
REDIS_ENABLED=true  # 启用 Redis 存储元数据和标签
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_PREFIX=imageflow:
REDIS_TLS_ENABLED=false  # 启用 Redis TLS 连接

# S3 存储配置（当 STORAGE_TYPE=s3 时需要）
S3_ENDPOINT=  # S3 端点地址
S3_REGION=    # S3 区域
S3_ACCESS_KEY=  # 访问密钥
S3_SECRET_KEY=  # 访问密钥密文
S3_BUCKET=      # 存储桶名称
CUSTOM_DOMAIN=  # 自定义域名

# 图像处理配置
MAX_UPLOAD_COUNT=20    # 单次最大上传数量
IMAGE_QUALITY=80      # 图像质量（1-100）
WORKER_THREADS=4      # 并行处理线程数
COMPRESSION_EFFORT=6  # 压缩级别（1-10）
FORCE_LOSSLESS=false  # 是否强制无损压缩
```

### 元数据迁移

如果您在之前使用基于文件的元数据存储后启用了 Redis，可以将元数据迁移到 Redis：

```bash
# 运行迁移工具
bash migrate.sh

# 强制迁移（即使之前已完成）
bash migrate.sh --force

# 指定自定义 .env 文件
bash migrate.sh --env /path/to/.env
``` 